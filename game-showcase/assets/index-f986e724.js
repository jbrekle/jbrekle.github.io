(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function l(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=l(s);fetch(s.href,n)}})();function ee(t,e){const l=document.getElementById("menuOverlay");l.style.display="flex";const a=document.getElementById("gameTitle");a&&(a.innerText="MoJo's Valentine Adventure",a.style.fontSize="48px",a.style.textAlign="center",a.style.marginTop="20px");const s=document.getElementById("welcomeMessage");s&&(s.innerText="Welcome to the ultimate panda rescue adventure!",s.style.fontSize="24px",s.style.textAlign="center",s.style.marginTop="10px"),document.getElementById("btnMona").addEventListener("click",()=>{t("Mona"),document.getElementById("btnMona").classList.add("selected"),document.getElementById("btnJonas").classList.remove("selected")}),document.getElementById("btnJonas").addEventListener("click",()=>{t("Jonas"),document.getElementById("btnJonas").classList.add("selected"),document.getElementById("btnMona").classList.remove("selected")}),document.getElementById("startGameBtn").addEventListener("click",e)}function D(t,e,l){return Math.min(Math.max(t,e),l)}function c(t,e){return .5*(1+t/e)}function X(){const t=["Love","Care","Trust","Passion","Admire","Cherish","Devotion","Adore","Fondness","Embrace"];return t[Math.floor(Math.random()*t.length)]}function $(){const t=["Dream","Achieve","Inspire","Shine","Grow","Believe","Aspire","Soar","Flourish","Radiate"];return t[Math.floor(Math.random()*t.length)]}function S(t,e){e.push({text:t,time:0,lifetime:2e3})}function T(t,e,l,a){a.push({text:t,x:e,y:l,time:0,lifetime:1e3})}function I(t,e,l,a,s,n){t.beginPath(),t.moveTo(e+n,l),t.lineTo(e+a-n,l),t.quadraticCurveTo(e+a,l,e+a,l+n),t.lineTo(e+a,l+s-n),t.quadraticCurveTo(e+a,l+s,e+a-n,l+s),t.lineTo(e+n,l+s),t.quadraticCurveTo(e,l+s,e,l+s-n),t.lineTo(e,l+n),t.quadraticCurveTo(e,l,e+n,l),t.closePath()}function V(t,e,l,a,s){t.save(),t.translate(e,l),t.beginPath(),t.moveTo(0,a*.3),t.bezierCurveTo(-a,-a*.2,-a*1.1,a*.8,0,a*1.3),t.bezierCurveTo(a*1.1,a*.8,a,-a*.2,0,a*.3),t.closePath();let n=t.createLinearGradient(-a,-a,a,a);n.addColorStop(0,"#ff3366"),n.addColorStop(1,"#ff6699"),t.fillStyle=n,t.fill(),t.strokeStyle="#990033",t.lineWidth=2,t.stroke(),t.beginPath(),t.moveTo(0,a*.45),t.bezierCurveTo(-a*.3,a*.3,-a*.2,a*.8,0,a*.9),t.bezierCurveTo(a*.2,a*.8,a*.3,a*.3,0,a*.45),t.closePath(),t.fillStyle="rgba(255,255,255,0.5)",t.fill(),t.fillStyle="#fff",t.font=`${a*.4}px sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(s,0,a*.65),t.restore()}function J(t,e,l,a,s){t.save(),t.translate(e,l);const n=5,o=a,r=a*.5;let h=Math.PI/2*3;const d=Math.PI/n;t.beginPath();for(let y=0;y<n;y++){let g=Math.cos(h)*o,p=Math.sin(h)*o;t.lineTo(g,p),h+=d;let m=Math.cos(h)*r,w=Math.sin(h)*r;t.lineTo(m,w),h+=d}t.closePath();let f=t.createRadialGradient(0,0,r,0,0,o);f.addColorStop(0,"#ffeb3b"),f.addColorStop(1,"#fbc02d"),t.fillStyle=f,t.fill(),t.strokeStyle="#c79100",t.lineWidth=2,t.stroke(),t.fillStyle="#000",t.font=`${a*.3}px sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(s,0,0),t.restore()}function C(t,e,l,a,s,n="male"){t.save(),t.translate(e,l),t.beginPath(),t.ellipse(0,a*.3,a,a*.8,0,0,Math.PI*2),t.fillStyle="#fff",t.fill(),t.strokeStyle="#000",t.stroke(),t.beginPath(),t.arc(0,-a*.2,a*.6,0,Math.PI*2),t.fill(),t.stroke();const o=a*.4,r=-a*.5,h=a*.2;t.beginPath(),t.arc(-o,r,h,0,Math.PI*2),t.fillStyle="#000",t.fill(),t.beginPath(),t.arc(-o,r,h*.6,0,Math.PI*2),t.fillStyle="#fff",t.fill(),t.beginPath(),t.arc(o,r,h,0,Math.PI*2),t.fillStyle="#000",t.fill(),t.beginPath(),t.arc(o,r,h*.6,0,Math.PI*2),t.fillStyle="#fff",t.fill();const d=a*.25,f=-a*.2,y=a*.15;t.beginPath(),t.arc(-d,f,y,0,Math.PI*2),t.arc(d,f,y,0,Math.PI*2),t.fillStyle="#000",t.fill(),t.beginPath(),t.arc(-d-2,f-2,y*.5,0,Math.PI*2),t.fillStyle="#fff",t.fill(),t.beginPath(),t.arc(d-2,f-2,y*.5,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(0,-a*.05,a*.1,0,Math.PI,!1),t.fillStyle="#000",t.fill(),t.beginPath(),t.moveTo(-a*.1,0),t.quadraticCurveTo(0,a*.1,a*.1,0),t.stroke(),n==="female"&&(t.beginPath(),t.moveTo(0,-a*.6),t.lineTo(-a*.3,-a*.8),t.lineTo(0,-a*.7),t.lineTo(a*.3,-a*.8),t.closePath(),t.fillStyle="#ff69b4",t.fill(),t.stroke());const g=Math.sin(s/200)*a*.1;t.fillStyle="#000",t.beginPath(),t.arc(-a*.7+g,a*.2,a*.15,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(a*.7-g,a*.2,a*.15,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(-a*.4+g,a*.9,a*.15,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(a*.4-g,a*.9,a*.15,0,Math.PI*2),t.fill(),t.restore()}function te(t,e,l,a){t.save(),t.translate(e,l),t.beginPath(),t.moveTo(0,-a*.8),t.lineTo(a*.3,a*.4),t.lineTo(-a*.3,a*.4),t.closePath();let s=t.createLinearGradient(0,-a*.8,0,a*.4);s.addColorStop(0,"#ddd"),s.addColorStop(1,"#aaa"),t.fillStyle=s,t.fill(),t.strokeStyle="#555",t.stroke(),t.beginPath(),t.moveTo(0,-a*.8),t.lineTo(a*.15,-a*.6),t.lineTo(-a*.15,-a*.6),t.closePath(),t.fillStyle="#ff4444",t.fill(),t.stroke(),t.beginPath(),t.moveTo(-a*.3,a*.4),t.lineTo(-a*.45,a*.2),t.lineTo(-a*.3,a*.2),t.closePath(),t.fillStyle="#ffcc00",t.fill(),t.stroke(),t.beginPath(),t.moveTo(a*.3,a*.4),t.lineTo(a*.45,a*.2),t.lineTo(a*.3,a*.2),t.closePath(),t.fillStyle="#ffcc00",t.fill(),t.stroke(),t.beginPath(),t.moveTo(-a*.15,a*.4),t.bezierCurveTo(-a*.15,a*.7,a*.15,a*.7,a*.15,a*.4),t.closePath(),t.fillStyle="orange",t.fill(),t.strokeStyle="red",t.stroke(),t.restore()}class ie{constructor(e,l,a,s){this.x=e,this.y=l,this.vx=a,this.vy=s,this.radius=6,this.trail=[]}update(e){this.trail.push({x:this.x,y:this.y,time:Date.now()});const l=Date.now();this.trail=this.trail.filter(a=>l-a.time<200),this.x+=this.vx*e/1e3,this.y+=this.vy*e/1e3}draw(e){e.save();for(let l=0;l<this.trail.length;l++){const a=this.trail[l],s=(l+1)/this.trail.length*.5;e.fillStyle=`rgba(255,69,0,${s})`,e.beginPath(),e.arc(a.x,a.y,this.radius,0,Math.PI*2),e.fill()}e.fillStyle="orange",e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.fill(),e.restore()}}class q{constructor(e,l,a){this.type=e,this.x=l,this.y=a,this.vy=0,this.hit=!1,this.effectTime=0,this.size=60,e==="heart"?(this.scoreValue=15,this.label=X()):e==="star"?(this.scoreValue=20,this.label=$()):e==="panda"&&(this.scoreValue=25,this.gender=Math.random()<.5?"female":"male",this.state="free",this.animationTime=0,this.collectionTimer=void 0)}update(e,l){if((this.type!=="panda"||this.state==="free")&&(this.y+=l*e/1e3),this.hit&&(this.effectTime+=e),this.type==="panda"&&this.state==="free"&&(this.animationTime+=e),this.type==="panda"&&this.state==="beingCollected")if(this.collectionTimer===void 0)this.collectionTimer=0;else{this.collectionTimer+=e;const a=Math.min(this.collectionTimer/500,1),s=window.game.player.backpack,n=s.y+s.height/2;this.y=(1-a)*(s.y-20)+a*n,a>=1&&(this.state="collected",T("+"+this.scoreValue,window.game.player.backpack.x+window.game.player.backpack.width/2,window.game.player.backpack.y,window.game.pointAnimations),window.game.score+=this.scoreValue,S(`${window.game.player.avatar} rescued a panda`,window.game.logMessages),window.game.player.backpackJiggleTime=500,window.game.rescuedPandas.push(this))}}draw(e,l){e.save();const a=l(this.y);if(e.translate(this.x,this.y),e.scale(a,a),this.type==="heart"){const s=this.hit?this.effectTime/500:0;e.globalAlpha=this.hit?Math.max(1-this.effectTime/500,0):1,V(e,0,0,this.size/2+s,this.label)}else if(this.type==="star"){const s=this.hit?this.effectTime/300:0;e.globalAlpha=this.hit?Math.max(1-this.effectTime/300,0):1,J(e,0,0,this.size/2+s,this.label)}else this.type==="panda"&&(this.state==="free"||this.state==="beingCollected")&&C(e,0,0,this.size/2,this.animationTime,this.gender);e.restore()}}class A{constructor(e,l,a,s){this.type=e,this.x=l,this.y=a,this.vy=0,this.size=80,this.levelName=s}update(e,l){this.y+=l*e/1e3}draw(e){e.save();const l=c(this.y,window.innerHeight);if(e.translate(this.x,this.y),e.scale(l,l),this.levelName==="City"){if(this.type==="building"){e.fillStyle="#666",e.fillRect(-20,-40,40,80),e.beginPath(),e.moveTo(-22,-40),e.lineTo(0,-60),e.lineTo(22,-40),e.closePath(),e.fillStyle="#444",e.fill(),e.fillStyle="#ffd700";for(let a=-35;a<40;a+=15)for(let s=-15;s<15;s+=15)e.fillRect(s,a,8,10);e.fillStyle="#330000",e.fillRect(-7,20,14,20)}else if(this.type==="lamp"){e.fillStyle="#444",e.fillRect(-5,0,10,5),e.fillStyle="#888",e.fillRect(-2,-30,4,30),e.beginPath(),e.arc(0,-30,8,Math.PI,0),e.fillStyle="#ffcc00",e.fill(),e.strokeStyle="rgba(255,255,0,0.5)",e.lineWidth=2;for(let a=-1;a<=1;a+=.5)e.beginPath(),e.moveTo(a*8,-30),e.lineTo(a*12,-42),e.stroke()}}else if(this.levelName==="Forest"){if(this.type==="tree"){e.fillStyle="#8B4513",e.fillRect(-5,0,10,30),e.strokeStyle="#8B4513",e.lineWidth=2,e.beginPath(),e.moveTo(0,10),e.lineTo(-10,0),e.moveTo(0,15),e.lineTo(10,5),e.stroke(),e.fillStyle="#228B22";for(let a=-15;a<=15;a+=10)e.beginPath(),e.arc(a,-10,12,0,Math.PI*2),e.fill()}else if(this.type==="bush"){e.fillStyle="#2E8B57";for(let a=-10;a<=10;a+=10)for(let s=-10;s<=10;s+=10)e.beginPath(),e.arc(a,s,10,0,Math.PI*2),e.fill()}}else if(this.levelName==="Space"){if(this.type==="satellite"){e.fillStyle="#ccc",e.fillRect(-10,-10,20,20),e.fillStyle="#999";for(let a=-8;a<=8;a+=8)for(let s=-8;s<=8;s+=8)e.fillRect(a,s,4,4);e.fillStyle="#88f",e.fillRect(-30,-8,15,16),e.fillRect(15,-8,15,16),e.beginPath(),e.moveTo(0,-10),e.lineTo(0,-20),e.strokeStyle="#666",e.lineWidth=2,e.stroke(),e.beginPath(),e.arc(0,10,3,0,Math.PI*2),e.fillStyle="orange",e.fill()}else if(this.type==="comet"){e.fillStyle="#fff",e.beginPath(),e.arc(0,0,10,0,Math.PI*2),e.fill();let a=e.createLinearGradient(0,0,-30,10);a.addColorStop(0,"rgba(255,255,255,0.8)"),a.addColorStop(1,"rgba(255,255,255,0)"),e.strokeStyle=a,e.lineWidth=6,e.beginPath(),e.moveTo(0,0),e.lineTo(-30,10),e.stroke(),e.fillStyle="#ddd";for(let s=0;s<3;s++)e.beginPath(),e.arc(-10-s*3,5+s*2,1.5,0,Math.PI*2),e.fill()}}e.restore()}}class ae{constructor(e,l,a){this.type=e,this.x=l,this.y=a,this.vy=0,this.size=60}update(e,l){this.y+=l*e/1e3}draw(e,l){e.save();const a=c(this.y,window.innerHeight);if(e.translate(this.x,this.y),e.scale(a,a),l==="City")if(this.type==="car"){e.beginPath(),e.moveTo(-30,-10),e.lineTo(30,-10),e.lineTo(25,10),e.lineTo(-25,10),e.closePath();let s=e.createLinearGradient(-30,-10,30,10);s.addColorStop(0,"#333"),s.addColorStop(1,"#777"),e.fillStyle=s,e.fill(),e.fillStyle="#aaf",e.fillRect(-20,-5,40,8),e.fillStyle="#000",e.beginPath(),e.arc(-20,15,8,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(20,15,8,0,Math.PI*2),e.fill(),e.fillStyle="#ffddaa",e.beginPath(),e.arc(28,-5,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(22,-5,3,0,Math.PI*2),e.fill(),e.strokeStyle="#222",e.lineWidth=1;for(let n=-10;n<10;n+=4)e.beginPath(),e.moveTo(n,-10),e.lineTo(n,-5),e.stroke()}else this.type==="person"?(e.fillStyle="#ffe0bd",e.beginPath(),e.arc(0,-20,12,0,Math.PI*2),e.fill(),e.fillStyle="#ff6699",e.fillRect(-10,-8,20,30),e.strokeStyle="#000",e.beginPath(),e.moveTo(-10,0),e.lineTo(-20,10),e.moveTo(10,0),e.lineTo(20,10),e.stroke(),e.beginPath(),e.moveTo(-5,22),e.lineTo(-5,40),e.moveTo(5,22),e.lineTo(5,40),e.stroke()):this.type==="bike"&&(e.strokeStyle="#000",e.lineWidth=3,e.beginPath(),e.arc(-15,10,10,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(15,10,10,0,Math.PI*2),e.stroke(),e.beginPath(),e.moveTo(-15,10),e.lineTo(0,-5),e.lineTo(15,10),e.stroke(),e.beginPath(),e.moveTo(0,-5),e.lineTo(0,10),e.stroke());else if(l==="Forest")this.type==="stone"?(e.beginPath(),e.ellipse(0,0,25,15,0,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#555",e.stroke()):this.type==="mouse"?(e.beginPath(),e.ellipse(0,0,20,10,0,0,Math.PI*2),e.fillStyle="#aaa",e.fill(),e.beginPath(),e.arc(-15,-10,4,0,Math.PI*2),e.arc(15,-10,4,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(-10,-5,2,0,Math.PI*2),e.arc(10,-5,2,0,Math.PI*2),e.fill()):this.type==="mushroom"&&(e.fillStyle="#fff",e.fillRect(-5,0,10,15),e.beginPath(),e.arc(0,0,15,Math.PI,0),e.fillStyle="#ff6699",e.fill(),e.fillStyle="#fff",e.beginPath(),e.arc(-5,-5,2,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(5,-5,2,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(0,-10,2,0,Math.PI*2),e.fill());else if(l==="Space")if(this.type==="planet"){let s=e.createRadialGradient(0,0,10,0,0,30);s.addColorStop(0,"#66ccff"),s.addColorStop(1,"#003366"),e.fillStyle=s,e.beginPath(),e.arc(0,0,30,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(0,0,35,10,Math.PI/4,0,Math.PI*2),e.strokeStyle="rgba(255,255,255,0.6)",e.lineWidth=2,e.stroke(),e.fillStyle="rgba(0,0,0,0.2)",e.beginPath(),e.arc(-10,5,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(15,-5,2,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255,255,255,0.2)";for(let n=0;n<5;n++)e.beginPath(),e.arc(Math.random()*20-10,Math.random()*20-10,1.5,0,Math.PI*2),e.fill()}else this.type==="alien"?(e.beginPath(),e.ellipse(0,0,25,20,0,0,Math.PI*2),e.fillStyle="#7fff00",e.fill(),e.strokeStyle="#006400",e.stroke(),e.fillStyle="#000",e.beginPath(),e.arc(-8,-5,3,0,Math.PI*2),e.arc(8,-5,3,0,Math.PI*2),e.fill(),e.beginPath(),e.moveTo(-10,-15),e.lineTo(-15,-25),e.moveTo(10,-15),e.lineTo(15,-25),e.strokeStyle="#006400",e.lineWidth=2,e.stroke(),e.beginPath(),e.arc(-15,-25,2,0,Math.PI*2),e.arc(15,-25,2,0,Math.PI*2),e.fillStyle="#006400",e.fill(),e.beginPath(),e.moveTo(0,10),e.lineTo(0,30),e.stroke(),e.fillStyle="#556B2F",e.beginPath(),e.arc(5,2,2,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(-5,2,2,0,Math.PI*2),e.fill()):this.type==="rocket"&&te(e,0,0,40);e.restore()}}class le{constructor(e,l,a,s,n,o=3){this.x=e,this.y=l,this.vx=a,this.vy=s,this.life=n,this.maxLife=n,this.radius=o}update(e){this.x+=this.vx*e/1e3,this.y+=this.vy*e/1e3,this.life-=e}draw(e){if(this.life>0){const l=this.life/this.maxLife;e.fillStyle=`rgba(255,215,0,${l})`,e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.fill()}}}class se{constructor(e,l,a,s){this.x=e,this.y=l,this.speed=a,this.size=s}update(e){this.x+=this.speed*e/1e3,this.x-this.size>window.innerWidth&&(this.x=-this.size)}draw(e){e.save(),e.fillStyle="rgba(255,255,255,0.8)",e.beginPath(),e.arc(this.x,this.y,this.size,0,Math.PI*2),e.fill(),e.restore()}}class ne{constructor(e,l,a){this.x=e,this.y=l,this.speed=a,this.wingTime=0}update(e){this.x+=this.speed*e/1e3,this.wingTime+=e,this.x>window.innerWidth+20&&(this.x=-20)}draw(e){e.save(),e.strokeStyle="#000",e.lineWidth=2,e.beginPath();const l=Math.sin(this.wingTime/200)*5;e.moveTo(this.x,this.y),e.lineTo(this.x-10,this.y-l),e.moveTo(this.x,this.y),e.lineTo(this.x+10,this.y-l),e.stroke(),e.restore()}}class oe{constructor(e,l){this.x=e,this.y=l,this.alpha=Math.random()}update(e){this.alpha+=(Math.random()-.5)*.01,this.alpha=Math.max(.3,Math.min(1,this.alpha))}draw(e){e.save(),e.fillStyle=`rgba(255,255,255,${this.alpha})`,e.beginPath(),e.arc(this.x,this.y,2,0,Math.PI*2),e.fill(),e.restore()}}class O{constructor(){this.type=Math.random()<.5?"heart":"star",this.label=this.type==="heart"?X():$(),this.scoreValue=this.type==="heart"?15:20,this.x=Math.random()*window.innerWidth,this.y=-50,this.vy=50+Math.random()*30,this.alpha=1,this.explosionTime=Math.random()*9e3+1e3}update(e){this.y+=this.vy*e/1e3,this.explosionTime-=e}draw(e){e.save(),e.globalAlpha=this.alpha,this.type==="heart"?V(e,this.x,this.y,30,this.label):J(e,this.x,this.y,30,this.label),e.restore()}}const u=[{name:"City",scrollSpeed:120,groundColor:"#dddddd",groundPattern:null,decorationTypes:["building","lamp"],createDecoration(t,e){let l=Math.random()<.7?"building":"lamp";return new A(l,t,e,this.name)},skyColor:"#a3d9ff",cloudColor:"rgba(255,255,255,0.8)"},{name:"Forest",scrollSpeed:100,groundColor:"#c8e6c9",groundPattern:null,decorationTypes:["tree","bush"],createDecoration(t,e){let l=Math.random()<.7?"tree":"bush";return new A(l,t,e,this.name)},skyColor:"#aaffaa",cloudColor:"rgba(255,255,255,0.8)"},{name:"Space",scrollSpeed:80,groundColor:"#222",groundPattern:null,decorationTypes:["satellite","comet"],createDecoration(t,e){let l=Math.random()<.5?"satellite":"comet";return new A(l,t,e,this.name)},skyColor:"#000",cloudColor:null}];function R(t,e,l){const a=document.createElement("canvas");a.width=50,a.height=50;const s=a.getContext("2d");if(s.fillStyle=e,s.fillRect(0,0,50,50),l==="City")s.strokeStyle="rgba(0,0,0,0.1)",s.lineWidth=1,s.beginPath(),s.moveTo(0,25),s.lineTo(50,25),s.moveTo(25,0),s.lineTo(25,50),s.stroke();else if(l==="Forest"){s.strokeStyle="rgba(0,150,0,0.3)";for(let n=0;n<50;n+=5)s.beginPath(),s.moveTo(n,0),s.lineTo(n,50),s.stroke()}else if(l==="Space"){s.fillStyle="rgba(255,255,255,0.1)";for(let n=0;n<8;n++)s.beginPath(),s.arc(Math.random()*50,Math.random()*50,1,0,Math.PI*2),s.fill()}return t.createPattern(a,"repeat")}function re(t){u[0].groundPattern=R(t,"#eeeeee","City"),u[1].groundPattern=R(t,"#dcedc8","Forest"),u[2].groundPattern=R(t,"#444","Space")}class F{constructor(e){this.avatar=e,this.width=100,this.height=160,this.x=window.innerWidth/2,this.y=window.innerHeight-10,this.speed=400,this.walkTime=0,this.shakeOffset={x:0,y:0},this.backpack={x:0,y:0,width:0,height:0},this.backpackJiggleTime=0}update(e){const l=window.innerWidth,a=window.innerHeight,s=Math.max(100,Math.min(l,a)*.1)/3;this.width=s,this.height=s*1.6,this.y=a-10,this.x=D(this.x,this.width/2,l-this.width/2),this.walkTime+=e,this.backpack.x=this.x-.3*this.width,this.backpack.y=this.y-.65*this.height,this.backpack.width=.6*this.width,this.backpack.height=.4*this.height,window.playerShakeTime>0?(window.playerShakeTime-=e,this.shakeOffset.x=(Math.random()-.5)*10,this.shakeOffset.y=(Math.random()-.5)*10):(this.shakeOffset.x=0,this.shakeOffset.y=0),this.backpackJiggleTime>0&&(this.backpackJiggleTime-=e)}draw(e){e.save(),e.translate(this.shakeOffset.x,this.shakeOffset.y);const l=this.x,a=this.y-this.height/2,s=this.width/2,n=this.height/2,o=e.createRadialGradient(l,a,s*.5,l,a,s);o.addColorStop(0,this.avatar==="Mona"?"#ffccd5":"#ffe0b3"),o.addColorStop(1,this.avatar==="Mona"?"#ff9999":"#ffcc99"),e.fillStyle=o,e.beginPath(),e.ellipse(l,a,s,n,0,0,Math.PI*2),e.fill(),e.strokeStyle="#ff6699",e.lineWidth=2,e.stroke();const r=this.width*.5,h=Math.sin(this.walkTime/150)*8;e.strokeStyle="#ffe0bd",e.lineWidth=4,e.beginPath(),e.moveTo(this.x-s,a),e.quadraticCurveTo(this.x-s-r*.3,a+h,this.x-s-r,a+r*.2),e.stroke(),e.beginPath(),e.moveTo(this.x+s,a),e.quadraticCurveTo(this.x+s+r*.3,a-h,this.x+s+r,a+r*.2),e.stroke();const d=this.width*.15,f=this.height*.3,y=Math.abs(Math.sin(this.walkTime/150))*5;e.fillStyle="#000",e.beginPath(),e.moveTo(this.x-d-5,this.y-f+y),e.lineTo(this.x-d-5,this.y+y),e.lineTo(this.x-5,this.y+y),e.lineTo(this.x-5,this.y-f+y),e.closePath(),e.fill(),e.beginPath(),e.moveTo(this.x+5,this.y-f+y),e.lineTo(this.x+5,this.y+y),e.lineTo(this.x+d+5,this.y+y),e.lineTo(this.x+d+5,this.y-f+y),e.closePath(),e.fill();const g=this.x,p=this.y-this.height-s*.5,m=s*1.2,w=e.createRadialGradient(g,p,m*.4,g,p,m);w.addColorStop(0,"#ffe0bd"),w.addColorStop(1,"#ffcc99"),e.fillStyle=w,e.beginPath(),e.arc(g,p,m,0,Math.PI*2),e.fill(),e.strokeStyle="#000",e.stroke(),e.save(),this.avatar==="Mona"?(e.fillStyle="#000",e.beginPath(),e.moveTo(g-m,p-m),e.quadraticCurveTo(g-m,p-m*.7,g-m*.8,p-m*.7),e.quadraticCurveTo(g,p-m*.8,g+m*.8,p-m*.7),e.quadraticCurveTo(g+m,p-m*.7,g+m,p-m),e.closePath(),e.fill()):(e.fillStyle="#8B4513",e.beginPath(),e.arc(g,p-m*.6,m*1.1,Math.PI,0,!1),e.fill()),e.restore();const v=m*.3,M=-m*.1,k=m*.2;e.fillStyle="#000",e.beginPath(),e.arc(g-v,p+M,k,0,Math.PI*2),e.arc(g+v,p+M,k,0,Math.PI*2),e.fill(),e.fillStyle="#fff",e.beginPath(),e.arc(g-v-2,p+M-2,k*.5,0,Math.PI*2),e.arc(g+v-2,p+M-2,k*.5,0,Math.PI*2),e.fill(),e.beginPath(),e.moveTo(g-m*.1,p+m*.1),e.quadraticCurveTo(g,p+m*.2,g+m*.1,p+m*.1),e.stroke(),e.save();let j=0;this.backpackJiggleTime>0&&(j=(Math.random()-.5)*8),e.translate(j,0),e.fillStyle="#8B4513",e.fillRect(this.backpack.x,this.backpack.y,this.backpack.width,this.backpack.height),e.strokeStyle="#000",e.strokeRect(this.backpack.x,this.backpack.y,this.backpack.width,this.backpack.height),e.beginPath(),e.moveTo(this.backpack.x,this.backpack.y+5),e.lineTo(this.x-this.width/2,this.y-this.height+10),e.moveTo(this.backpack.x+this.backpack.width,this.backpack.y+5),e.lineTo(this.x+this.width/2,this.y-this.height+10),e.stroke(),e.beginPath(),e.ellipse(this.backpack.x+this.backpack.width/2,this.backpack.y,this.backpack.width*.4,this.backpack.height*.3,0,0,Math.PI*2),e.strokeStyle="#fff",e.stroke(),e.restore(),e.restore()}}function Y(t,e,l,a,s,n,o){const r=Math.min(Math.max(s,t),t+l),h=Math.min(Math.max(n,e),e+a),d=s-r,f=n-h;return d*d+f*f<o*o}function N(t,e,l,a,s,n){t.save();const o=t.createLinearGradient(e,l,e,l+s);o.addColorStop(0,"#ffccdd"),o.addColorStop(1,"#ff6699"),t.fillStyle=o,t.shadowColor="rgba(0,0,0,0.3)",t.shadowBlur=4,I(t,e,l,a,s,8),t.fill(),t.strokeStyle="#fff",t.lineWidth=2,I(t,e,l,a,s,8),t.stroke(),t.fillStyle="#fff",t.font="16px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText(n,e+a/2,l+s/2),t.restore()}function K(t){const e=i.canvas.getBoundingClientRect(),l=t.clientX-e.left,a=t.clientY-e.top,s=i.canvas.width/2-70,n=i.canvas.height-100,o=140,r=50;l>=s&&l<=s+o&&a>=n&&a<=n+r&&(window.restartGame(),i.canvas.removeEventListener("click",K),i.winRestartListenerAdded=!1)}function he(t,e){for(let l=0;l<10;l++){const a=Math.random()*Math.PI*2,s=Math.random()*100+50,n=Math.cos(a)*s,o=Math.sin(a)*s;window.game.particles.push(new le(t,e,n,o,800,10))}}function de(t,e){for(let l=0;l<5;l++){const a=Math.random()*Math.PI*2,s=Math.random()*80+20,n=Math.cos(a)*s,o=Math.sin(a)*s;window.game.particles.push({x:t,y:e,vx:n,vy:o,life:2e3,maxLife:2e3,update:function(r){this.x+=this.vx*r/1e3,this.y+=this.vy*r/1e3,this.life-=r},draw:function(r){const h=this.life/this.maxLife;r.save(),r.translate(this.x,this.y),r.globalAlpha=h,r.beginPath();const d=40;r.moveTo(0,d*.25),r.bezierCurveTo(-d*.5,-d*.2,-d*.5,d*.6,0,d),r.bezierCurveTo(d*.5,d*.6,d*.5,-d*.2,0,d*.25),r.closePath(),r.fillStyle="red",r.fill(),r.strokeStyle="#000",r.lineWidth=2,r.stroke(),r.restore()}})}}function fe(){if(!i.winPandas||i.winPandas.length===0){i.winPandas=[];for(let t=0;t<5;t++)i.winPandas.push({x:Math.random()*i.canvas.width,y:Math.random()*i.canvas.height,dx:(Math.random()-.5)*2,dy:(Math.random()-.5)*2,time:0,gender:Math.random()<.5?"female":"male",collisionCooldown:0})}if(!i.winFallingTargets||i.winFallingTargets.length===0){i.winFallingTargets=[];for(let t=0;t<15;t++)i.winFallingTargets.push(new O)}i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height),i.ctx.fillStyle=u[i.currentLevelIndex].skyColor,i.ctx.fillRect(0,0,i.canvas.width,i.canvas.height),i.ctx.save(),i.ctx.font="32px sans-serif",i.ctx.fillStyle="#fff",i.ctx.textAlign="center",i.ctx.fillText("Congratulations!",i.canvas.width/2,60),i.ctx.font="28px sans-serif",i.ctx.fillText(`You rescued ${i.rescuedPandas.length} pandas!`,i.canvas.width/2,100),i.ctx.restore(),i.winFallingTargets.forEach((t,e)=>{t.update(16),t.draw(i.ctx),t.explosionTime<=0&&(he(t.x,t.y),i.winFallingTargets[e]=new O)}),i.winPandas.forEach(t=>{t.collisionCooldown===void 0?t.collisionCooldown=0:t.collisionCooldown>0&&(t.collisionCooldown-=16)});for(let t=0;t<i.winPandas.length;t++)for(let e=t+1;e<i.winPandas.length;e++){const l=i.winPandas[t],a=i.winPandas[e],s=l.x-a.x,n=l.y-a.y;Math.sqrt(s*s+n*n)<80&&l.collisionCooldown<=0&&a.collisionCooldown<=0&&(de((l.x+a.x)/2,(l.y+a.y)/2),l.collisionCooldown=1e3,a.collisionCooldown=1e3)}i.winPandas.forEach(t=>{t.x+=t.dx,t.y+=t.dy,(t.x<0||t.x>i.canvas.width)&&(t.dx*=-1),(t.y<0||t.y>i.canvas.height)&&(t.dy*=-1),t.time+=16,C(i.ctx,t.x,t.y,40,t.time,t.gender)}),N(i.ctx,i.canvas.width/2-70,i.canvas.height-100,140,50,"Restart"),i.winRestartListenerAdded||(i.winRestartListenerAdded=!0,i.canvas.addEventListener("click",K))}function L(t){i.lastTime||(i.lastTime=t);const e=t-i.lastTime;if(i.lastTime=t,i.state==="win"){fe(),requestAnimationFrame(L);return}ye(e),me(),requestAnimationFrame(L)}let i;function ge(t,e){const l=t.getContext("2d");return re(l),i={canvas:t,ctx:l,state:"playing",player:new F(e),projectiles:[],targets:[],obstacles:[],decorations:[],clouds:[],birds:[],spaceStars:[],particles:[],pointAnimations:[],logMessages:[],rescuedPandas:[],scrollOffset:0,score:0,spawnTimer:0,lastTime:0,currentLevelIndex:0,winPandas:[],winFallingTargets:[],winRestartListenerAdded:!1},window.game=i,i}function ye(t){if(i.state==="win")return;const e=u[i.currentLevelIndex];i.scrollOffset+=e.scrollSpeed*t/1e3,i.player.update(t),e.name!=="Space"?(i.clouds.forEach(l=>l.update(t)),i.birds.forEach(l=>l.update(t))):i.spaceStars.forEach(l=>l.update(t));for(let l=i.projectiles.length-1;l>=0;l--)i.projectiles[l].update(t),(i.projectiles[l].x<0||i.projectiles[l].x>i.canvas.width||i.projectiles[l].y<0||i.projectiles[l].y>i.canvas.height)&&i.projectiles.splice(l,1);for(let l=i.targets.length-1;l>=0;l--)i.targets[l].update(t,e.scrollSpeed),(i.targets[l].y-i.targets[l].size*c(i.targets[l].y,i.canvas.height)>i.canvas.height||i.targets[l].hit&&(i.targets[l].type==="heart"&&i.targets[l].effectTime>500||i.targets[l].type==="star"&&i.targets[l].effectTime>300))&&i.targets.splice(l,1);for(let l=i.obstacles.length-1;l>=0;l--)i.obstacles[l].update(t,e.scrollSpeed),i.obstacles[l].y>i.canvas.height&&i.obstacles.splice(l,1);for(let l=i.decorations.length-1;l>=0;l--)i.decorations[l].update(t,e.scrollSpeed),i.decorations[l].y>i.canvas.height&&i.decorations.splice(l,1);for(let l=i.particles.length-1;l>=0;l--)i.particles[l].update(t),i.particles[l].life<=0&&i.particles.splice(l,1);for(let l=i.pointAnimations.length-1;l>=0;l--)i.pointAnimations[l].time+=t,i.pointAnimations[l].y-=t*.03,i.pointAnimations[l].time>i.pointAnimations[l].lifetime&&i.pointAnimations.splice(l,1);for(let l=i.logMessages.length-1;l>=0;l--)i.logMessages[l].time+=t,i.logMessages[l].time>i.logMessages[l].lifetime&&i.logMessages.splice(l,1);i.rescuedPandas.forEach(l=>l.time+=t);for(let l=i.projectiles.length-1;l>=0;l--){const a=i.projectiles[l];for(let s=0;s<i.targets.length;s++){const n=i.targets[s];if(n.type==="panda")continue;const o=a.x-n.x,r=a.y-n.y;if(Math.sqrt(o*o+r*r)<a.radius+n.size/2*c(n.y,i.canvas.height)){(n.type==="heart"||n.type==="star")&&(n.hit||(n.hit=!0,T("+"+n.scoreValue,n.x,n.y,i.pointAnimations),i.score+=n.scoreValue,S(`${i.player.avatar} collected ${n.label}`,i.logMessages))),i.projectiles.splice(l,1);break}}}i.targets.forEach(l=>{(l.type==="heart"||l.type==="star")&&!l.hit&&Y(i.player.x-i.player.width/2,i.player.y-i.player.height,i.player.width,i.player.height,l.x,l.y,l.size/2*c(l.y,i.canvas.height))&&(l.hit=!0,T("+"+l.scoreValue,l.x,l.y,i.pointAnimations),i.score+=l.scoreValue,S(`${i.player.avatar} collected ${l.label}`,i.logMessages))}),i.targets.forEach(l=>{if(l.type==="panda"&&l.state==="free"){const a=i.player.backpack;l.x>a.x&&l.x<a.x+a.width&&l.y>a.y&&l.y<a.y+a.height&&(l.state="beingCollected",l.collectionTimer=void 0)}}),i.obstacles.forEach((l,a)=>{Y(i.player.x-i.player.width/2,i.player.y-i.player.height,i.player.width,i.player.height,l.x+l.size/2,l.y+l.size/2,l.size/2*c(l.y,i.canvas.height))&&(i.score=Math.max(0,i.score-5),T("-5",i.player.x,i.player.y,i.pointAnimations),S(`${i.player.avatar} hit an obstacle`,i.logMessages),window.playerShakeTime=500,i.obstacles.splice(a,1))});for(let l=i.projectiles.length-1;l>=0;l--){const a=i.projectiles[l];for(let s=i.obstacles.length-1;s>=0;s--){const n=i.obstacles[s],o=a.x-n.x,r=a.y-n.y;if(Math.sqrt(o*o+r*r)<a.radius+n.size/2*c(n.y,i.canvas.height)){i.obstacles.splice(s,1),i.projectiles.splice(l,1);break}}}if(i.spawnTimer+=t,i.spawnTimer>1e3){const a=i.canvas.height*.2+20,s=Math.random();if(s<.4)i.targets.push(new q(Math.random()<.5?"heart":"star",Math.random()*i.canvas.width,a));else if(s<.7)i.targets.push(new q("panda",Math.random()*i.canvas.width,a));else if(s<.8){let n;if(u[i.currentLevelIndex].name==="City"){const o=Math.random();n=o<.33?"car":o<.66?"person":"bike"}else if(u[i.currentLevelIndex].name==="Forest"){const o=Math.random();n=o<.33?"stone":o<.66?"mouse":"mushroom"}else if(u[i.currentLevelIndex].name==="Space"){const o=Math.random();n=o<.33?"planet":o<.66?"alien":"rocket"}i.obstacles.push(new ae(n,Math.random()*(i.canvas.width-80)+40,a))}else{const n=Math.random()<.5?Math.random()*50+10:i.canvas.width-(Math.random()*50+10);i.decorations.push(u[i.currentLevelIndex].createDecoration(n,a))}i.spawnTimer=0}if(i.score>=200)if(i.currentLevelIndex<u.length-1)if(i.score=0,i.currentLevelIndex++,i.targets=[],i.obstacles=[],i.decorations=[],i.scrollOffset=0,u[i.currentLevelIndex].name!=="Space"){i.clouds=[],i.birds=[];for(let l=0;l<5;l++)i.clouds.push(new se(Math.random()*i.canvas.width,Math.random()*i.canvas.height*.2,10+Math.random()*10,30+Math.random()*20));for(let l=0;l<3;l++)i.birds.push(new ne(Math.random()*i.canvas.width,Math.random()*i.canvas.height*.2,50+Math.random()*30))}else{i.spaceStars=[];for(let l=0;l<50;l++)i.spaceStars.push(new oe(Math.random()*i.canvas.width,Math.random()*i.canvas.height*.2))}else{if(!i.winPandas||i.winPandas.length===0){i.winPandas=[];for(let l=0;l<5;l++)i.winPandas.push({x:Math.random()*i.canvas.width,y:Math.random()*i.canvas.height,dx:(Math.random()-.5)*2,dy:(Math.random()-.5)*2,time:0,gender:Math.random()<.5?"female":"male",collisionCooldown:0})}if(!i.winFallingTargets||i.winFallingTargets.length===0){i.winFallingTargets=[];for(let l=0;l<15;l++)i.winFallingTargets.push(new O)}i.state="win"}}function me(){if(i.state==="win")return;i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height);const t=i.canvas.height*.2;i.ctx.fillStyle=u[i.currentLevelIndex].skyColor,i.ctx.fillRect(0,0,i.canvas.width,t),u[i.currentLevelIndex].name!=="Space"?(i.clouds.forEach(h=>h.draw(i.ctx)),i.birds.forEach(h=>h.draw(i.ctx))):i.spaceStars.forEach(h=>h.draw(i.ctx)),i.logMessages.length>0&&(i.ctx.save(),i.ctx.font="20px sans-serif",i.ctx.fillStyle="rgba(0,0,0,0.7)",i.ctx.textAlign="center",i.ctx.fillText(i.logMessages[0].text,i.canvas.width/2,40),i.ctx.restore()),i.ctx.save(),i.ctx.translate(0,t+i.scrollOffset%50),i.ctx.fillStyle=u[i.currentLevelIndex].groundPattern,i.ctx.fillRect(0,0,i.canvas.width,i.canvas.height-t),i.ctx.restore(),i.decorations.forEach(h=>h.draw(i.ctx)),i.obstacles.forEach(h=>h.draw(i.ctx,u[i.currentLevelIndex].name)),i.targets.forEach(h=>{h.type==="panda"&&h.state==="beingCollected"||h.draw(i.ctx,d=>c(d,i.canvas.height))}),i.projectiles.forEach(h=>h.draw(i.ctx)),i.particles.forEach(h=>h.draw(i.ctx)),i.ctx.save(),i.ctx.font="20px sans-serif",i.ctx.textAlign="center",i.pointAnimations.forEach(h=>{i.ctx.fillStyle="rgba(0,128,0,"+(1-h.time/h.lifetime)+")",i.ctx.fillText(h.text,h.x,h.y)}),i.ctx.restore(),i.player.draw(i.ctx),i.ctx.save();const e=200,l=Math.max(100,i.canvas.width*.5),a=Math.min(1,i.score/e),s=i.canvas.width-l-20,n=50,o=20,r=i.ctx.createLinearGradient(s,n,s,n+o);r.addColorStop(0,"#ff99a0"),r.addColorStop(1,"#ff3366"),i.ctx.strokeStyle="#333",i.ctx.lineWidth=2,I(i.ctx,s,n,l,o,10),i.ctx.stroke(),i.ctx.save(),i.ctx.beginPath(),I(i.ctx,s,n,l*a,o,10),i.ctx.clip(),i.ctx.fillStyle=r,i.ctx.fillRect(s,n,l*a,o),i.ctx.restore(),i.ctx.fillStyle="#333",i.ctx.font="16px sans-serif",i.ctx.textAlign="right",i.ctx.fillText(`Level ${i.currentLevelIndex+1}/${u.length}`,i.canvas.width-20,n+o+20),i.ctx.restore(),N(i.ctx,20,20,80,30,"Menu")}let B=!1,H=0,b=null,W=null;function pe(t){W=t}function ue(t,e,l,a){function s(d){const f=t.getBoundingClientRect();let y,g;return d.touches&&d.touches.length>0?(y=d.touches[0].clientX-f.left,g=d.touches[0].clientY-f.top):(y=d.clientX-f.left,g=d.clientY-f.top),{x:y,y:g}}function n(d){const f=s(d);if(f.x>=20&&f.x<=100&&f.y>=20&&f.y<=50){a();return}if(!b){if(f.x>e.x-e.width&&f.x<e.x+e.width&&f.y>e.y-e.height-50&&f.y<e.y){B=!0,H=f.x-e.x,d.preventDefault();return}for(let y of window.game.targets)if(y.type==="panda"&&y.state==="free"){const g=f.x-y.x,p=f.y-y.y;if(Math.sqrt(g*g+p*p)<y.size/2){b=y,d.preventDefault();return}}h(f)}}function o(d){const f=s(d);B&&(e.x=f.x-H,e.x=D(e.x,e.width/2,t.width-e.width/2)),b&&(b.x=f.x,b.y=f.y)}function r(d){B=!1,b=null}function h(d){const f=d.x-e.x,y=d.y-(e.y-e.height/2),g=Math.sqrt(f*f+y*y),p=500,m=f/g*p,w=y/g*p;W&&W(e.x,e.y-e.height/2,m,w)}t.addEventListener("mousedown",n),t.addEventListener("touchstart",n),t.addEventListener("mousemove",o),t.addEventListener("touchmove",o),t.addEventListener("mouseup",r),t.addEventListener("touchend",r)}let P=0;function ce(){requestAnimationFrame(U)}function we(t){P+=t}function be(t,e,l){t.clearRect(0,0,e.width,e.height);const a=new F(l||"Mona");a.width*=3,a.height*=3,a.x=e.width/2,a.y=e.height/2,a.backpack.x=a.x-.3*a.width,a.backpack.y=a.y-.65*a.height,a.backpack.width=.6*a.width,a.backpack.height=.4*a.height,a.walkTime=P,a.update(0),a.draw(t),t.save(),t.translate(e.width*.25,e.height/2),C(t,0,0,40,P,"female"),t.restore(),t.save(),t.translate(e.width*.75,e.height/2),C(t,0,0,40,P,"male"),t.restore()}function U(t){const e=t-(P||t);we(e);const l=document.getElementById("menuAnim"),a=l.getContext("2d");be(a,l,window.selectedAvatar||"Mona"),requestAnimationFrame(U)}window.PlayerClass=F;window.selectedAvatar="Mona";window.playerShakeTime=0;const E=document.getElementById("gameCanvas");E.width=window.innerWidth;E.height=window.innerHeight;function Q(t){window.selectedAvatar=t}function Z(){document.getElementById("menuOverlay").style.display="none";const t=ge(E,window.selectedAvatar);pe((e,l,a,s)=>{t.projectiles.push(new ie(e,l,a,s))}),ue(E,t.player,t.targets,_),requestAnimationFrame(L)}function _(){document.getElementById("pauseOverlay").style.display="flex"}function z(){document.getElementById("pauseOverlay").style.display="none",window.game&&(window.game.state="playing",requestAnimationFrame(L))}function G(){document.getElementById("pauseOverlay").style.display="none",document.getElementById("menuOverlay").style.display="flex",window.game&&(window.game.state="menu")}function x(){G()}ee(Q,Z);document.getElementById("resumeBtn").addEventListener("click",z);document.getElementById("changeAvatarBtn").addEventListener("click",G);document.getElementById("restartBtn").addEventListener("click",x);window.selectAvatar=Q;window.startGame=Z;window.pauseGame=_;window.resumeGame=z;window.changeAvatar=G;window.restartGame=x;ce();document.addEventListener("keydown",t=>{t.key==="w"&&window.game&&(window.game.state="win")});
